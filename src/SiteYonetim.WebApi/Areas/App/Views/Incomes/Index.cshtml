@model IReadOnlyList<SiteYonetim.Domain.Entities.Income>
@{
    ViewData["Title"] = "Gelirler (Aidat)";
    var siteId = (Guid)ViewBag.SiteId;
    var year = (int)ViewBag.Year;
    var month = (int)ViewBag.Month;
    var total = ViewBag.Total as decimal? ?? 0;
    var monthNames = new[] { "", "Ocak", "Şubat", "Mart", "Nisan", "Mayıs", "Haziran", "Temmuz", "Ağustos", "Eylül", "Ekim", "Kasım", "Aralık" };
}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0">Gelirler (Aidat) - @year @monthNames[month]</h1>
    <div>
        <form asp-area="App" asp-controller="Incomes" asp-action="CreateMonth" method="post" class="d-inline" asp-route-siteId="@siteId" asp-route-year="@year" asp-route-month="@month">
            @Html.AntiForgeryToken()
            <button type="submit" class="btn btn-success me-2"><i class="bi bi-plus-circle me-1"></i> Bu Ay Aidat Oluştur</button>
        </form>
        <a asp-area="App" asp-controller="Sites" asp-action="Index" class="btn btn-outline-secondary">Site Değiştir</a>
    </div>
</div>
<div class="row mb-3">
    <div class="col-md-4">
        <div class="card border-0 bg-success text-white">
            <div class="card-body">
                <h6 class="card-subtitle mb-1">Toplam Gelir</h6>
                <h4 class="card-title mb-0">@total.ToString("N2") ₺</h4>
            </div>
        </div>
    </div>
</div>
@if (Model != null && Model.Count > 0)
{
    <div class="card border-0 shadow-sm">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Blok / Bina</th>
                        <th>Daire No</th>
                        <th>Malik</th>
                        <th>Tutar</th>
                        <th>Ödeme Dönemi</th>
                        <th>Durum</th>
                        <th width="100"></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var i in Model)
                    {
                        <tr>
                            <td>@(i.Apartment?.BlockOrBuildingName ?? "-")</td>
                            <td><strong>@(i.Apartment?.ApartmentNumber ?? "-")</strong></td>
                            <td>@(i.Apartment?.OwnerName ?? "-")</td>
                            <td>@i.Amount.ToString("N2") ₺</td>
                            <td><small>@i.PaymentStartDate.ToString("dd.MM")-@i.PaymentEndDate.ToString("dd.MM.yyyy")</small></td>
                            <td>
                                @if (i.Status == IncomeStatus.Paid)
                                { <span class="badge bg-success">Ödendi</span> }
                                else
                                { <span class="badge bg-warning text-dark">Bekliyor</span> }
                            </td>
                            <td>
                                @if (i.Status != IncomeStatus.Paid)
                                {
                                    <a asp-area="App" asp-controller="Incomes" asp-action="Collect" asp-route-id="@i.Id" class="btn btn-sm btn-success">Tahsil Et</a>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
}
else
{
    <div class="alert alert-info">
        Bu ay için henüz aidat kaydı yok. <strong>"Bu Ay Aidat Oluştur"</strong> ile tüm dairelere aylık aidat oluşturabilirsiniz.
        Site ve dairelerde varsayılan aidat tutarını (Site düzenle: Varsayılan aylık aidat, Daire düzenle: Aylık aidat) tanımlayın.
    </div>
}
