<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Site Yönetim</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />
    <style>
        .sidebar { min-height: 100vh; background: #1e3a5f; }
        .sidebar .nav-link { color: rgba(255,255,255,.8); }
        .sidebar .nav-link:hover, .sidebar .nav-link.active { color: #fff; background: rgba(255,255,255,.1); }
        .navbar-brand { font-weight: 600; }
        @@media print {
            .sidebar { display: none !important; }
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        }
    </style>
</head>
<body>
    <div class="d-flex">
        <div class="sidebar flex-shrink-0 p-3" style="width: 240px;">
            <a class="navbar-brand text-white d-flex align-items-center mb-4" href="/Dashboard">
                <i class="bi bi-building me-2"></i> Site Yönetim
            </a>
            @{
                var qSiteId = Context.Request.Query["siteId"].FirstOrDefault() ?? ViewBag.SiteId?.ToString() ?? "";
                var siteQ = !string.IsNullOrEmpty(qSiteId) ? $"?siteId={qSiteId}" : "";
                var qYear = ViewBag.Year != null ? ViewBag.Year.ToString() : Context.Request.Query["year"].FirstOrDefault();
                var qMonth = ViewBag.Month != null ? ViewBag.Month.ToString() : Context.Request.Query["month"].FirstOrDefault();
                var paymentsQ = siteQ + (!string.IsNullOrEmpty(qYear) && !string.IsNullOrEmpty(qMonth) ? (string.IsNullOrEmpty(siteQ) ? "?" : "&") + $"year={qYear}&month={qMonth}" : "");
            }
            <ul class="nav flex-column">
                <li class="nav-item"><a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Dashboard" ? "active" : "")" href="/Dashboard"><i class="bi bi-speedometer2 me-2"></i> Panel</a></li>
                <li class="nav-item"><a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Sites" ? "active" : "")" href="/Sites"><i class="bi bi-building me-2"></i> Siteler</a></li>
                <li class="nav-item"><a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Apartments" ? "active" : "")" href="/Apartments@(siteQ)"><i class="bi bi-door-open me-2"></i> Daireler</a></li>
                <li class="nav-item"><a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Incomes" ? "active" : "")" href="/Incomes@(siteQ)"><i class="bi bi-cash-coin me-2"></i> Gelirler</a></li>
                <li class="nav-item"><a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "ExpenseTypes" ? "active" : "")" href="/ExpenseTypes@(siteQ)"><i class="bi bi-tags me-2"></i> Gider Türleri</a></li>
                <li class="nav-item"><a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Expenses" ? "active" : "")" href="/Expenses@(siteQ)"><i class="bi bi-cash-stack me-2"></i> Giderler</a></li>
                <li class="nav-item"><a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Payments" ? "active" : "")" href="/Payments@(paymentsQ)"><i class="bi bi-wallet2 me-2"></i> Tahsilatlar</a></li>
                <li class="nav-item"><a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "BankAccounts" ? "active" : "")" href="/BankAccounts@(siteQ)"><i class="bi bi-bank me-2"></i> Banka Hesapları</a></li>
                <li class="nav-item"><a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Debtors" ? "active" : "")" href="/Debtors"><i class="bi bi-people me-2"></i> Borçlular</a></li>
                <li class="nav-item"><a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Quotations" ? "active" : "")" href="/Quotations@(siteQ)"><i class="bi bi-file-earmark-text me-2"></i> Teklifler</a></li>
                <li class="nav-item"><a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "SiteResidents" ? "active" : "")" href="/SiteResidents@(siteQ)"><i class="bi bi-people me-2"></i> Site Sakinleri</a></li>
                <li class="nav-item"><a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "ImportantPhones" ? "active" : "")" href="/ImportantPhones@(siteQ)"><i class="bi bi-telephone-forward me-2"></i> Önemli Telefonlar</a></li>
                <li class="nav-item"><a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "SupportTickets" ? "active" : "")" href="/SupportTickets"><i class="bi bi-headset me-2"></i> Destek Kayıtları</a></li>
                <li class="nav-item"><a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "SupportSettings" ? "active" : "")" href="/SupportSettings@(siteQ)"><i class="bi bi-gear me-2"></i> Destek Kayıt Ayarları</a></li>
                <li class="nav-item"><a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Meters" ? "active" : "")" href="/Meters@(siteQ)"><i class="bi bi-speedometer me-2"></i> Sayaçlar</a></li>
                <li class="nav-item"><a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Reports" ? "active" : "")" href="/Reports@(siteQ)"><i class="bi bi-graph-up me-2"></i> Raporlar</a></li>
                <li class="nav-item mt-3"><a class="nav-link text-warning" href="#" onclick="document.getElementById('logoutForm').submit(); return false;"><i class="bi bi-box-arrow-right me-2"></i> Çıkış</a></li>
            </ul>
            <form id="logoutForm" asp-area="" asp-controller="Account" asp-action="Logout" method="post" class="d-none"></form>
        </div>
        <div class="flex-grow-1 d-flex flex-column">
            <div class="sticky-top bg-white border-bottom px-3 py-2 d-flex justify-content-end align-items-center gap-2" style="z-index: 1020;">
                @await Component.InvokeAsync("PaidExpenseNotification")
                <a asp-area="App" asp-controller="Profile" asp-action="Index" class="btn btn-link text-dark text-decoration-none p-2" title="Profil"><i class="bi bi-person-circle fs-5"></i> Profil</a>
            </div>
            <div class="flex-grow-1 p-4 bg-light">
                @RenderBody()
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.5/dist/jquery.validate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation-unobtrusive@4.0.0/dist/jquery.validate.unobtrusive.min.js"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
